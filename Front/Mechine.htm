<!DOCTYPE html>
<html lang="zh-hant" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ©Ÿå™¨</title>

    <!-- Sweet alert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Bootstarp5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

    <!-- CSS & Js -->
    <link href="css/style.css" rel="stylesheet">
    <script src="js/function.js"></script>
    <script src="js/webapi.js"></script>
</head>

<script>
    // ç”¨ Webapi å»è·Ÿå¾Œç«¯å‘¼å« Machine çš„è³‡æ–™ï¼Œä¸¦é¡¯ç¤ºåœ¨ table ä¸Šé¢
    async function GetMachineList() {
        // å‘¼å«å¾Œç«¯çš„ machine è³‡æ–™ã€‚
        let machinelist = await API_GetMachineList()

        // æŒ‡å®šæ”¾å…¥ UI çš„è¡¨æ ¼ ID å’Œ tbody æ¬„ä½
        let tbody = document.querySelector("#tableMachine tbody");

        // å…ˆæ¸…ç©ºè¡¨æ ¼è£¡é¢çš„å€¼ã€‚
        while (tbody.firstChild) {
            tbody.removeChild(tbody.firstChild);
        }

        // å»ºç«‹å…§å®¹çµ¦è¡¨æ ¼ (æ ¹æ“š WebAPI æŠ“åˆ°çš„ list å€¼)
        machinelist.forEach(element => {

            // å»ºç«‹ä¸€å€‹åˆ—
            let row = document.createElement('tr');

            // å»ºç«‹ä¸€å€‹ ID çš„æ¬„ä½
            let idCell = document.createElement('td');
            idCell.textContent = element.id;

            // å»ºç«‹ä¸€å€‹ Name çš„æ¬„ä½
            let nameCell = document.createElement('td');
            nameCell.textContent = element.name;

            // å»ºç«‹ä¸€å€‹ Create DateTime çš„æ¬„ä½
            let dateTimeCell = document.createElement('td');
            dateTimeCell.textContent = element.createDateTime;

            // å»ºç«‹ä¸€å€‹ Place çš„æ¬„ä½
            let placeTimeCell = document.createElement('td');
            placeTimeCell.textContent = element.place;

            // å»ºç«‹ä¸€å€‹ Modfiy Button çš„æ¬„ä½
            let modifyCell = document.createElement('td');

            // æŒ‰éˆ•è¨­å®š
            let modifybtn = document.createElement('button');
            modifybtn.textContent = 'ä¿®æ”¹';
            modifybtn.classList.add('btn', 'btn-warning');
            modifybtn.onclick = () => openModifyModal(element.id, element.name, element.createDateTime, element.place);

            // åŠ å…¥
            modifyCell.append(modifybtn);

            // å»ºç«‹ä¸€å€‹ Delete Button çš„æ¬„ä½
            let deleteCell = document.createElement('td');

            // æŒ‰éˆ•è¨­å®š
            let deletebtn = document.createElement('button');
            deletebtn.textContent = 'åˆªé™¤';
            deletebtn.classList.add('btn', 'btn-danger');
            deletebtn.onclick = () => btnDeleteMachine(element.id, element.name);

            // åŠ å…¥
            deleteCell.append(deletebtn);

            // åŠ å…¥æ¬„ä½åˆ—å…§ã€‚
            row.append(idCell);
            row.append(nameCell);
            row.append(dateTimeCell);
            row.append(placeTimeCell);
            row.append(modifyCell);
            row.append(deleteCell);

            // å°‡åˆ—åŠ å…¥åˆ°è¡¨æ ¼çš„bodyè£¡é¢ã€‚
            tbody.append(row);
        });
    }

    // å½ˆå‡ºè¦–çª—é¡¯ç¤ºå‡½å¼ (é¿å…é‡è¤‡æ’°å¯«)
    function showSwal(title, text, icon, confirmText) {
        return Swal.fire({
            title: title,
            text: text,
            icon: icon,
            confirmButtonText: confirmText
        });
    }

    // åˆªé™¤æŒ‰éˆ•äº‹ä»¶
    async function btnDeleteMachine(machineID, machineName) {
        // é¡¯ç¤ºç¢ºèªåˆªé™¤çš„å½ˆå‡ºè¦–çª—
        const isCheck = await Swal.fire({
            title: 'åˆªé™¤',
            text: `ä½ ç¢ºå®šè¦åˆªé™¤ã€${machineID} | ${machineName}ã€‘å—ï¼Ÿ`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'åˆªé™¤',
            cancelButtonText: 'å–æ¶ˆ'
        });

        // å¦‚æœä½¿ç”¨è€…ç¢ºèªåˆªé™¤
        if (isCheck.isConfirmed) {
            const isDelete = await API_DeleteMachine(machineID);

            if (isDelete.error) {
                // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                showSwal('éŒ¯èª¤', 'åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error', 'ç¢ºå®š');
                return;
            }

            // é‡æ–°æ›´æ–°æ©Ÿå™¨æ¸…å–®
            GetMachineList();

            // é¡¯ç¤ºåˆªé™¤æˆåŠŸè¨Šæ¯
            showSwal('åˆªé™¤æˆåŠŸ', `æˆåŠŸå°‡ã€${machineID} | ${machineName}ã€‘åˆªé™¤ï¼`, 'success', 'ç¢ºå®š');
        }
    }

    // æ–°å¢æŒ‰éˆ•äº‹ä»¶
    async function btnAddMachine() {
        // æŠ“å–ä½¿ç”¨è€…è¼¸å…¥çš„æ©Ÿå™¨åç¨±å’Œæ”¾ç½®å€åŸŸ
        const name = document.getElementById('txtboxAddMachineName').value;
        const place = document.getElementById('txtboxAddMachinePlace').value;

        // å‘¼å« API æ–°å¢æ©Ÿå™¨
        await API_AddMachine(name, place);

        // é‡æ–°æ›´æ–°æ©Ÿå™¨æ¸…å–®
        GetMachineList();

        // é¡¯ç¤ºæ–°å¢æˆåŠŸè¨Šæ¯
        Swal.fire({
            title: 'æˆåŠŸ',
            text: `${name} | ${place}`,
            icon: 'success',
            confirmButtonText: 'ç¢ºå®š'
        }).then((result) => {
            if (result.isConfirmed) {
                // æ¸…ç©ºæ–‡å­—æ¡†
                document.getElementById('txtboxAddMachineName').value = '';
                document.getElementById('txtboxAddMachinePlace').value = '';

                // é—œé–‰ Modal è¦–çª—
                const btnCloseModal = document.getElementById('btnCloseAddMachineModal');
                btnCloseModal.click();
            }
        });
    }

    // é–‹å•Ÿä¿®æ”¹æ©Ÿå™¨çš„ Modal è¦–çª—
    function openModifyModal(id, name, createtime, place) {
        // å¡«å…¥ä¿®æ”¹æ¡†ä¸­çš„é è¨­å€¼
        const machineID = document.getElementById("txtboxModifyMachineID");
        const machineName = document.getElementById("txtboxModifyMachineName");
        const machineCreateTime = document.getElementById("txtboxModifyMachineCreateTime");
        const machinePlace = document.getElementById("txtboxModifyMachinePlace");
        machineID.value = id;
        machineName.value = name;
        machineCreateTime.value = createtime;
        machinePlace.value = place;

        // é¡¯ç¤ºä¿®æ”¹æ©Ÿå™¨çš„ Modal è¦–çª—
        const modalElement = document.getElementById('ModifyMachineModal');
        const modal = new bootstrap.Modal(modalElement);
        modal.show();
    }

    // ä¿®æ”¹æ©Ÿå™¨è³‡è¨Šçš„äº‹ä»¶
    async function btnModifyMachine() {
        // å–å¾—ä½¿ç”¨è€…è¼¸å…¥çš„ä¿®æ”¹å€¼
        const id = document.getElementById('txtboxModifyMachineID').value;
        const name = document.getElementById('txtboxModifyMachineName').value;
        const place = document.getElementById('txtboxModifyMachinePlace').value;

        // å‘¼å« API ä¿®æ”¹æ©Ÿå™¨è³‡æ–™
        await API_ModifyMachine(id, name, place);

        // é‡æ–°æ›´æ–°æ©Ÿå™¨æ¸…å–®
        GetMachineList();

        // é¡¯ç¤ºä¿®æ”¹æˆåŠŸè¨Šæ¯
        Swal.fire({
            title: 'æˆåŠŸ',
            text: `[${id}] ${name} | ${place}`,
            icon: 'success',
            confirmButtonText: 'ç¢ºå®š'
        }).then((result) => {
            if (result.isConfirmed) {
                // é—œé–‰ Modal è¦–çª—
                const btnCloseModal = document.getElementById('btnCloseModifyMachineModal');
                btnCloseModal.click();
            }
        });
    }

    // ç•¶é é¢è¼‰å…¥æ™‚ï¼Œè¼‰å…¥æ©Ÿå™¨æ¸…å–®
    window.onload = function () {
        GetMachineList();
        const currentTheme = window.matchMedia("(prefers-color-scheme: dark)").matches;

        var htmlTag = document.documentElement;
        if (currentTheme) {
            // ç•¶ä½¿ç”¨è€…çš„åå¥½æ˜¯æš—è‰²æ¨¡å¼æ™‚
            htmlTag.setAttribute('data-bs-theme', 'dark');
            this.textContent = 'â˜€ï¸';  // ä½¿ç”¨æš—è‰²æ¨¡å¼æ™‚é¡¯ç¤º â˜€ï¸
        } else {
            // ç•¶ä½¿ç”¨è€…çš„åå¥½æ˜¯æ˜äº®æ¨¡å¼æ™‚
            htmlTag.setAttribute('data-bs-theme', 'light');
            this.textContent = 'ğŸŒ™';  // ä½¿ç”¨æ˜äº®æ¨¡å¼æ™‚é¡¯ç¤º ğŸŒ™
        }
    };

    document.addEventListener('DOMContentLoaded', function () {
        const themeToggleBtn = document.getElementById('theme-toggle-btn');

        // è¨­å®šåˆå§‹åœ–ç¤º
        themeToggleBtn.textContent = document.documentElement.getAttribute('data-bs-theme') === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';

        themeToggleBtn.addEventListener('click', function (e) {
            e.preventDefault();

            const htmlTag = document.documentElement;
            const currentTheme = htmlTag.getAttribute('data-bs-theme');

            if (currentTheme === 'light') {
                htmlTag.setAttribute('data-bs-theme', 'dark');
                this.textContent = 'â˜€ï¸';
            } else {
                htmlTag.setAttribute('data-bs-theme', 'light');
                this.textContent = 'ğŸŒ™';
            }
        });
    });


</script>

<body>
    <!-- å°è¦½åˆ— -->
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <div class="container">
            <ul class="navbar-nav">
                <a class="nav-link" id="theme-toggle-btn" href="#">åˆ‡æ›ä¸»é¡Œ</a>
                <li class="nav-item">
                    <a class="nav-link" href="#">å·¥å» </a>
                <li class="nav-item">
                    <a class="nav-link active" href="#">æ©Ÿå™¨</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="Project.htm">å°ˆæ¡ˆ</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- å…§å®¹ -->
    <div class="container mt-5 content">
        <!-- æ¨™é¡Œ -->
        <h1>æ©Ÿå™¨</h1><br>

        <!-- å¡ç‰‡ -->
        <div class="card shadow-sm">
            <div class="card-body">

                <!-- æ¨™ç±¤è·ŸæŒ‰éˆ• -->
                <div class="d-flex justify-content-between align-items-center mb-3">

                    <!-- æ¨™ç±¤ -->
                    <h5 class="card-title mb-0">æ©Ÿå™¨æ¸…å–®</h5>

                    <!-- æŒ‰éˆ• -->
                    <button class="btn btn-outline-info " data-bs-toggle="modal" data-bs-target="#AddMachineModal">
                        æ–°å¢
                    </button>
                </div>

                <!-- Machineè³‡æ–™çš„è¡¨æ ¼ -->
                <div class="table-responsive">
                    <table class="table table-hover align-middle" id="tableMachine">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>åç¨±</th>
                                <th>å»ºç«‹æ—¥æœŸ</th>
                                <th>æ”¾ç½®å€åŸŸ</th>
                                <th>ä¿®æ”¹</th>
                                <th>åˆªé™¤</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>

    <!-- é‚£å€‹ä»¤äººè¨å­çš„ Poppup -->
    <div class="modal fade" id="AddMachineModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content shadow">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">æ–°å¢æ©Ÿå°</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        id="btnCloseAddMachineModal"></button>
                </div>
                <div class="modal-body">

                    <!-- Input the machine name. -->
                    <div class="mb-3">
                        <label class="form-label">åç¨±ï¼š</label>
                        <input type="text" class="form-control" id="txtboxAddMachineName" placeholder="æ©Ÿå™¨åç¨±">
                    </div>

                    <!-- Input the place. -->
                    <div class="mb-3">
                        <label class="form-label">åœ°é»ï¼š</label>
                        <input type="text" class="form-control" id="txtboxAddMachinePlace" placeholder="å»ºç«‹æ©Ÿå™¨åœ°é»">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="btnAddMachine()">ç¢ºå®š</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Modify the machine -->
    <div class="modal fade" id="ModifyMachineModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content shadow">
                <div class="modal-header bg-warning text-black">
                    <h5 class="modal-title">ä¿®æ”¹æ©Ÿå™¨</h5>
                    <button type="button" class="btn-close btn-close-black" data-bs-dismiss="modal"
                        id="btnCloseModifyMachineModal"></button>
                </div>
                <div class="modal-body">

                    <!-- Textbox of the MachineID -->
                    <div class="mb-3">
                        <label class="form-label">IDï¼š</label>
                        <input type="text" class="form-control" id="txtboxModifyMachineID" disabled>
                    </div>

                    <!-- Input the machine name. -->
                    <div class="mb-3">
                        <label class="form-label">åç¨±ï¼š</label>
                        <input type="text" class="form-control" id="txtboxModifyMachineName"
                            placeholder="Enter the name of the machine.">
                    </div>

                    <!-- Textbox of machine's CreateTime -->
                    <div class="mb-3">
                        <label class="form-label">å»ºç«‹æ—¥æœŸï¼š</label>
                        <input type="text" class="form-control" id="txtboxModifyMachineCreateTime" disabled>
                    </div>

                    <!-- Input the place. -->
                    <div class="mb-3">
                        <label class="form-label">åœ°é»ï¼š</label>
                        <input type="text" class="form-control" id="txtboxModifyMachinePlace"
                            placeholder="Enter the place where the new machine.">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" onclick="btnModifyMachine()">ç¢ºå®š</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æœ€åº•ä¸‹çš„é»‘ç·š -->
    <footer class="text-center">
        <p class="mb-0">ç‰ˆæ¬Šæ‰€æœ‰ - 2025 æ™ºæ…§è£½é€ èª²ç¨‹</p>
    </footer>

    </div>
    </div>
    </div>
</body>

</html>